/*
 * MPlayer ver. 1.0.0
 * jQuery Sound Manger 2 Plugin
 *
 * Copyright (c) 2013 Mariusz Rek
 * Rascals Labs 2013
 *
 */
 

(function(g){var f=null,a=null,d=null,c=true,e=null;var b={init:function(h){f=this;a=h;g.ajax({url:h.sm,dataType:"script",success:function(){$smObj={onready:function(){soundManager._writeDebug("SM2 ready!");
d=true;f.MPlayer("update");h.onReady.call(this);soundManager._writeDebug("MPlayer ready!");return;},ontimeout:function(){soundManager._writeDebug("SM2 init failed!");
},defaultOptions:{volume:100,usePeakData:false}};g.extend(h.smOptions,$smObj);soundManager.setup(h.smOptions);}});},update:function(){var h=".mp-playlist";
if(a.playlistSelector!=undefined&&a.playlistSelector!=""){h=a.playlistSelector;}if(g(h).length>0){g(h).each(function(j){var m=g(this),l=m.data("autoplay"),k=m.data("playnext");
$length=m.find(f).length-1;k==undefined||k==false?k=false:k=true;l==undefined||l==false?l=false:l=true;m.find(f).each(function(n){if(l&&n==0){g(this).data("autoplay",true);
}if(k&&n<$length){g(this).data("playnext",true);}});});}f.each(function(j){var p=g(this),m,o=null,l,n="mp"+j,k=p.data("autoplay"),m=p.data("title"),l=p.data("url");
k==undefined||k==false?k=false:k=true;m!=undefined&&m!=""?m=m:m=p.text();l!=undefined&&l!=""?l=l:l=p.attr("href");if(!soundManager.canPlayURL(l)){soundManager._writeDebug(l+" - this track can not be played!");
}p.attr("id",n);$ui_markup='   				<span class="ui timing">   					<span class="elapsed"></span><span class="total"></span>   				</span>   				<span class="ui progress">   					<span class="loading"></span><span class="position"></span>   				</span>  ';
if(a.uiMarkup!=undefined&&a.uiMarkup!=""){$ui_markup=a.uiMarkup;}p.append($ui_markup);$sound=p.data("mplayer");p.data("mplayer",soundManager.createSound({id:n,url:l,onload:function(){soundManager._writeDebug("----------- onLoad - "+this.id);
p.triggerHandler("mponloaded.mplayer");p.addClass("loaded").removeClass("loading");},onplay:function(){soundManager._writeDebug("----------- onplay - "+this.id);
p.triggerHandler("mponplay.mplayer");p.removeClass("paused").addClass("playing");if(p.data("mplayer").readyState==1){p.addClass("loading");}},onpause:function(){soundManager._writeDebug("---------- onpause - "+this.id);
p.triggerHandler("mponpause.mplayer");if(!o){p.removeClass("playing").addClass("paused");}},onresume:function(){soundManager._writeDebug("--------- onresume - "+this.id);
p.triggerHandler("mponresume.mplayer");p.removeClass("paused").addClass("playing");},onstop:function(){soundManager._writeDebug("----------- onstop - "+this.id);
p.triggerHandler("mponstop.mplayer");p.removeClass("playing loading paused");p.find(".elapsed, .total").empty();p.find(".position").width(0);},onfinish:function(){soundManager._writeDebug("-------- onfinish - "+this.id);
p.triggerHandler("mponfinish.mplayer");p.removeClass("playing loading paused");p.find(".elapsed, .total").empty();p.find(".position").width(0);if(p.data("playnext")!=undefined&&p.data("playnext")==true){soundManager._writeDebug("---------------------------> next");
var q=j+1,i=g("#mp"+q);if(i.length>0){i.data("mplayer").play();e=i.data("mplayer");}}},whileloading:function(){p.find(".loading").width(p.data("mplayer").bytesLoaded/p.data("mplayer").bytesTotal*100+"%");
},whileplaying:function(){p.find(".position").width(p.data("mplayer").position/p.data("mplayer").durationEstimate*100+"%");p.find(".elapsed").html(_formatTime(p.data("mplayer").position));
p.find(".total").html(" / "+_formatTime(p.data("mplayer").durationEstimate));}})).addClass("ready").click(function(i){$this=g(this).data("mplayer");if(e&&e!=$this){e.stop();
e.setPosition(0);}if(!$this.paused){e=$this;}$this.togglePause();i.preventDefault();}).bind("mponloaded.mplayer",function(){p.triggerHandler("onloaded");
}).bind("mponplay.mplayer mponresume.mplayer",function(){p.triggerHandler("onplay");}).bind("mponpause.mplayer",function(){p.triggerHandler("onpause");
}).bind("mponstop.mplayer",function(){p.triggerHandler("onstop");}).bind("mponfinish.mplayer",function(){p.triggerHandler("onfinish");}).find(".ui").bind("click",function(){return false;
}).filter(".progress").bind("mousedown",function(t){var i=g(this).addClass("searching"),u=i.find(".postion"),r=i.offset().left,q=i.width(),s=i.parent().data("mplayer");
o=true;s.pause();g(document).bind("mousemove",function(w){var v=Math.max(0,Math.min(w.clientX-r,q));u.width(v);s.setPosition(v/q*s.durationEstimate);return false;
}).bind("mouseup",function(v){o=false;if(i.removeClass("searching").parent().hasClass("playing")){s.resume();}g(this).unbind("mousemove mouseup");return false;
}).trigger({type:"mousemove",clientX:t.clientX});return false;});if(k&&c){c=false;p.data("mplayer").play();e=p.data("mplayer");}});_formatTime=function(j){var l=Math.floor(j/1000),i=Math.floor(l/60),k=l-i*60;
return i+":"+(k<10?"0"+k:k);};},play:function(){if(!d){return;}soundManager._writeDebug("PLAY EVENT");$this=g(this).data("mplayer");if(e&&e!=$this){e.stop();
e.setPosition(0);}if($this.playState==0||$this.paused){$this.play();e=$this;}},pause:function(){if(!d){return;}soundManager._writeDebug("PAUSE EVENT");
$this=g(this).data("mplayer");if($this.playState==1){$this.pause();}},stop:function(){if(!d){return;}soundManager._writeDebug("STOP EVENT");$this=g(this).data("mplayer");
$this.stop();$this.setPosition(0);}};g.fn.MPlayer=function(h){if(b[h]){return b[h].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof h==="object"||!h){return b.init.apply(this,arguments);
}else{g.error("Method "+method+" does not exist on jQuery.MPlayer");}}};})(jQuery);